@{
    ViewBag.Title = "Open Loan Account";
}

<div class="container py-4">
    <h2>Open New Loan</h2>

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@Html.Raw(TempData["Error"])</div>
    }
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@Html.Raw(TempData["Success"])</div>
    }

    @using (Html.BeginForm("OpenLoanAccountManager", "Home", FormMethod.Post))
    {
        @Html.AntiForgeryToken()
        <div class="row g-3">
            <div class="col-md-4">
                <label class="form-label">Customer ID</label>
                <input name="CustID" class="form-control" value="@ViewBag.LastCustID" placeholder="Enter Customer ID" />
            </div>
            <div class="col-md-4">
                <label class="form-label">Loan Amount (Rs)</label>
                <input name="LoanAmount" type="number" step="0.01" min="10000" class="form-control" placeholder="Min 10,000" />
            </div>
            <div class="col-md-4">
                <label class="form-label">Tenure (Years)</label>
                <input name="Tenure" type="number" min="1" max="30" class="form-control" />
            </div>
            <div class="col-md-4">
                <label class="form-label">Start Date</label>
                <input name="StartDate" type="date" class="form-control" value="@DateTime.Today.ToString("yyyy-MM-dd")" />
            </div>
            <div class="col-md-4">
                <label class="form-label">Monthly Take Home (Rs)</label>
                <input name="MonthlyIncome" type="number" step="0.01" min="1" class="form-control" />
            </div>
        </div>
        <div class="mt-3">
            <button type="submit" class="btn btn-primary">Open Loan</button>
            <a href="@Url.Action("ViewLoanAccounts", "Home")" class="btn btn-secondary ms-2">Back</a>
        </div>
    }

    @if (ViewBag.NewLoanId != null)
    {
        <hr />
        <div class="card">
            <div class="card-body">
                <h5>Loan Opened</h5>
                <p><strong>Account No:</strong> @ViewBag.NewLoanId</p>
                <p><strong>Customer ID:</strong> @ViewBag.CustID</p>
                <p><strong>Loan Amount:</strong> Rs @ViewBag.LoanAmount</p>
                <p><strong>Interest Rate:</strong> @ViewBag.InterestRate%</p>
                <p><strong>Tenure:</strong> @ViewBag.TenureYears years</p>
                <p><strong>EMI:</strong> Rs @ViewBag.EMI</p>
                <p><strong>Outstanding (initial):</strong> Rs @ViewBag.TotalPayable</p>
                <p><strong>End Date:</strong> @ViewBag.EndDate</p>
            </div>
        </div>
    }
</div>
